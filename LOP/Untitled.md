# Метод ветвей и границ (Branch and Bound, B&B) с LP-релаксацией для LOP

## 1. Формулировка задачи
**Линейное упорядочение (LOP)** заключается в поиске перестановки элементов, максимизирующей сумму весов пар элементов, где вес учитывается, если первый элемент предшествует второму. 

- **Целевая функция**:
  $$
  \max \sum_{i \neq j} W_{ij} \cdot x_{ij},
  $$
  где \( x_{ij} = 1 \), если элемент \( i \) предшествует \( j \), и \( 0 \) иначе.

- **Ограничения**:
  - \( x_{ij} + x_{ji} = 1 \) для всех \( i \neq j \).
  - Транзитивность: \( x_{ij} + x_{jk} - x_{ik} \leq 1 \) для всех троек \( i, j, k \).

## 2. LP-релаксация
- Целочисленные переменные \( x_{ij} \in \{0,1\} \) заменяются на непрерывные: \( 0 \leq x_{ij} \leq 1 \).
- Решение релаксированной задачи даёт **верхнюю границу** целевой функции.
- Если решение целочисленное и транзитивное, оно оптимально.

## 3. Ветвление
- Выбирается переменная \( x_{ij} \), значение которой в LP-решении ближе всего к \( 0.5 \) (наиболее неопределённая).
- Создаются две подзадачи:
  - **Ветвь 1**: \( x_{ij} = 1 \).
  - **Ветвь 2**: \( x_{ij} = 0 \).

## 4. Обработка ограничений транзитивности
- При решении LP-релаксации проверяется наличие нарушений транзитивности (например, циклы из трёх элементов).
- Нарушающие ограничения добавляются динамически (**Branch-and-Cut**), чтобы уменьшить вычислительную нагрузку.

## 5. Отсечение ветвей
- Если верхняя граница LP-релаксации для подзадачи меньше текущего лучшего целочисленного решения, ветвь **отсекается**.

## 6. Алгоритм
1. **Инициализация**: корневой узел с LP-релаксацией.
2. Пока есть неисследованные узлы:
   - Выбрать узел с наивысшей верхней границей.
   - Решить LP-релаксацию. 
     - Если решение целочисленное и транзитивное → обновить лучшее решение.
     - Иначе:
       - Выбрать переменную для ветвления.
       - Создать подзадачи, добавив новые ограничения.
       - Добавить подзадачи в очередь узлов.

## 7. Оптимизации
- **Эвристики**: Быстрый поиск начальных решений для раннего отсечения.
- **Стратегии ветвления**: Приоритет переменным, сильнее влияющим на целевую функцию.
- **Динамическое добавление ограничений**: Включение только необходимых ограничений транзитивности.

## Пример работы
Для трёх элементов \( A, B, C \) LP-релаксация дала:
- \( x_{AB} = 0.8 \), \( x_{BC} = 0.6 \), \( x_{AC} = 0.3 \).

Это нарушает транзитивность (\( A \rightarrow B \rightarrow C \), но \( A \nrightarrow C \)), поэтому добавляется ограничение:
$$
x_{AB} + x_{BC} - x_{AC} \leq 1.
$$
Если после этого верхняя граница ухудшается → ветвь отсекается.

## Итог
Метод B&B с LP-релаксацией эффективен для LOP, но требует:
- Аккуратного управления ограничениями транзитивности.
- Опти